---
import WikiLayout from '../../layouts/WikiLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Sidebar from '../../components/Sidebar.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import TableOfContents from '../../components/TableOfContents.astro';
import SocialShare from '../../components/SocialShare.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
	const currentAffairsEntries = await getCollection('currentAffairs');
	return currentAffairsEntries.map((entry) => ({
		params: { slug: entry.id },
		props: { entry },
	}));
}

const { entry } = Astro.props;

if (!entry) {
	return Astro.redirect('/404');
}

const { Content, headings } = await render(entry);

// Generate structured data for article
const structuredData = {
	"@context": "https://schema.org",
	"@type": "NewsArticle",
	"headline": entry.data.title,
	"description": entry.data.summary,
	"author": {
		"@type": "Organization",
		"name": "Exam Prep Wiki Team"
	},
	"datePublished": entry.data.date.toISOString(),
	"dateModified": entry.data.date.toISOString(),
	"publisher": {
		"@type": "EducationalOrganization",
		"name": "Exam Prep Wiki",
		"url": Astro.site
	},
	"articleSection": "Current Affairs",
	"keywords": entry.data.tags?.join(', '),
	"about": entry.data.topics?.join(', ')
};
---

<WikiLayout 
	title={entry.data.title} 
	description={entry.data.summary}
	keywords={entry.data.tags}
	publishDate={entry.data.date}
	modifiedDate={entry.data.date}
	structuredData={structuredData}
>
	<Header slot="header" />
	<Sidebar slot="sidebar" category="current-affairs" />
	
	<article class="wiki-article current-affairs-article">
		<Breadcrumb items={[
			{ label: 'Current Affairs', href: '/current-affairs' },
			{ label: entry.data.category, href: `/current-affairs?category=${entry.data.category}` },
			{ label: entry.data.title, href: '#' }
		]} />
		
		<div class="article-header">
			<div class="importance-badge" data-importance={entry.data.importance}>
				{entry.data.importance === 'high' ? 'üî¥' : entry.data.importance === 'medium' ? 'üü°' : 'üü¢'}
				{entry.data.importance.toUpperCase()} IMPORTANCE
			</div>
			
			<h1>{entry.data.title}</h1>
			
			<div class="article-meta">
				<span class="meta-item">
					<strong>üìÖ Date:</strong> {new Date(entry.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
				</span>
				<span class="meta-item">
					<strong>üìÇ Category:</strong> {entry.data.category}
				</span>
				{entry.data.exams && entry.data.exams.length > 0 && (
					<span class="meta-item">
						<strong>üéØ Relevant for:</strong> {entry.data.exams.join(', ')}
					</span>
				)}
			</div>
			
			{entry.data.topics && entry.data.topics.length > 0 && (
				<div class="topics-list">
					<strong>Topics:</strong>
					{entry.data.topics.map((topic) => (
						<span class="topic-tag">{topic}</span>
					))}
				</div>
			)}
			
			{entry.data.summary && (
				<div class="summary-box">
					<strong>üìå Summary:</strong>
					<p>{entry.data.summary}</p>
				</div>
			)}
			
			{entry.data.tags && entry.data.tags.length > 0 && (
				<div class="article-tags">
					{entry.data.tags.map((tag) => (
						<span class="tag">{tag}</span>
					))}
				</div>
			)}
		</div>
		
		<div class="article-content">
			<Content />
		</div>
		
		<SocialShare 
			title={entry.data.title} 
			description={entry.data.summary}
		/>
		
		<section class="article-footer">
			<div class="footer-actions">
				<a href="/current-affairs" class="action-btn">
					üì∞ More Current Affairs
				</a>
				<a href="/practice" class="action-btn">
					‚úèÔ∏è Practice Questions
				</a>
				<a href="/tests" class="action-btn">
					üìã Take a Test
				</a>
			</div>
		</section>
	</article>
	
	<TableOfContents slot="toc" headings={headings} />
	
	<Footer slot="footer" />
</WikiLayout>

<style>
	.current-affairs-article {
		position: relative;
	}
	
	.article-header {
		margin-bottom: var(--space-xl);
		padding-bottom: var(--space-lg);
		border-bottom: 2px solid var(--color-border);
	}
	
	.importance-badge {
		display: inline-block;
		padding: 0.5rem 1rem;
		margin-bottom: var(--space-md);
		font-size: 0.75rem;
		font-weight: 700;
		border-radius: var(--radius-sm);
		letter-spacing: 0.5px;
	}
	
	.importance-badge[data-importance="high"] {
		background-color: #FEE2E2;
		color: #991B1B;
		border: 1px solid #FCA5A5;
	}
	
	.importance-badge[data-importance="medium"] {
		background-color: #FEF3C7;
		color: #92400E;
		border: 1px solid #FCD34D;
	}
	
	.importance-badge[data-importance="low"] {
		background-color: #D1FAE5;
		color: #065F46;
		border: 1px solid #6EE7B7;
	}
	
	.article-meta {
		display: flex;
		flex-wrap: wrap;
		gap: var(--space-md);
		margin-top: var(--space-md);
		font-size: var(--font-size-small);
		color: var(--color-text-secondary);
	}
	
	.meta-item {
		display: flex;
		gap: var(--space-xs);
		align-items: center;
	}
	
	.topics-list {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: var(--space-sm);
		margin-top: var(--space-md);
		font-size: var(--font-size-small);
	}
	
	.topic-tag {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		background-color: var(--color-accent-blue);
		color: white;
		font-size: 0.75rem;
		border-radius: var(--radius-sm);
		font-weight: 500;
	}
	
	.summary-box {
		margin-top: var(--space-md);
		padding: var(--space-md);
		background-color: #EFF6FF;
		border-left: 4px solid var(--color-accent-blue);
		border-radius: var(--radius-sm);
		font-size: var(--font-size-small);
	}
	
	.summary-box strong {
		display: block;
		margin-bottom: var(--space-xs);
		color: var(--color-accent-blue);
	}
	
	.summary-box p {
		margin: 0;
		line-height: 1.6;
	}
	
	.article-tags {
		display: flex;
		flex-wrap: wrap;
		gap: var(--space-xs);
		margin-top: var(--space-md);
	}
	
	.tag {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		background-color: var(--color-bg-secondary);
		color: var(--color-text-secondary);
		font-size: 0.75rem;
		border-radius: var(--radius-sm);
		border: 1px solid var(--color-border-light);
	}
	
	.article-content {
		line-height: var(--line-height-base);
	}
	
	.article-footer {
		margin-top: var(--space-2xl);
		padding-top: var(--space-xl);
		border-top: 1px solid var(--color-border-light);
	}
	
	.footer-actions {
		display: flex;
		flex-wrap: wrap;
		gap: var(--space-md);
	}
	
	.action-btn {
		display: inline-flex;
		align-items: center;
		gap: var(--space-sm);
		padding: var(--space-sm) var(--space-lg);
		background-color: var(--color-bg-secondary);
		color: var(--color-text-primary);
		text-decoration: none;
		border: 1px solid var(--color-border);
		border-radius: var(--radius-sm);
		font-size: var(--font-size-small);
		transition: all 0.2s;
	}
	
	.action-btn:hover {
		background-color: var(--color-bg-tertiary);
		border-color: var(--color-accent-blue);
		transform: translateY(-1px);
		box-shadow: var(--shadow-sm);
	}
	
	@media (max-width: 768px) {
		.article-meta {
			flex-direction: column;
			gap: var(--space-sm);
		}
		
		.footer-actions {
			flex-direction: column;
		}
		
		.action-btn {
			width: 100%;
			justify-content: center;
		}
	}
</style>
