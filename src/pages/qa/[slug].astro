---
import { getCollection, render } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import WikiLayout from '../../layouts/WikiLayout.astro';

export async function getStaticPaths() {
	const qaEntries = await getCollection('qa');
	return qaEntries.map((entry) => ({
		params: { slug: entry.id },
		props: { entry },
	}));
}

interface Props {
	entry: CollectionEntry<'qa'>;
}

const { entry } = Astro.props;
const { Content } = await render(entry);
const { question, answer, metaTitle, metaDescription, keywords, difficulty, tags, examRelevance, relatedTopics } = entry.data;
---

<WikiLayout 
	title={metaTitle} 
	description={metaDescription}
	keywords={keywords}
>
	<!-- Schema.org structured data for rich snippets -->
	<script type="application/ld+json" set:html={JSON.stringify({
		"@context": "https://schema.org",
		"@type": "FAQPage",
		"mainEntity": [{
			"@type": "Question",
			"name": question,
			"acceptedAnswer": {
				"@type": "Answer",
				"text": answer
			}
		}]
	})} />

	<!-- Breadcrumb Navigation -->
	<nav class="wiki-breadcrumb" aria-label="Breadcrumb">
		<ol>
			<li><a href="/">Home</a></li>
			<li><a href="/qa">Questions & Answers</a></li>
			<li aria-current="page">{question}</li>
		</ol>
	</nav>

	<div class="wiki-container">
		<!-- Main Content -->
		<main class="wiki-main-content">
			<article class="wiki-article">
				<!-- Article Header -->
				<header class="article-header">
					<h1 class="article-title">{question}</h1>
					
					<div class="article-meta">
						<span class="difficulty-badge difficulty-{difficulty}">{difficulty}</span>
						<span class="category-badge">{entry.data.category}</span>
					</div>

					<!-- Quick Answer Box -->
					<div class="quick-answer-box">
						<h2 class="quick-answer-label">Quick Answer</h2>
						<p class="quick-answer-text">{answer}</p>
					</div>
				</header>

				<!-- Main Content from Markdown -->
				<div class="article-content">
					<Content />
				</div>

				<!-- Tags Section -->
				{tags && tags.length > 0 && (
					<section class="article-tags">
						<h3>Tags</h3>
						<ul class="tag-list">
							{tags.map((tag) => (
								<li><a href={`/qa/tags/${tag}`} class="tag-link">{tag}</a></li>
							))}
						</ul>
					</section>
				)}

				<!-- Related Topics -->
				{relatedTopics && relatedTopics.length > 0 && (
					<section class="related-topics">
						<h3>Related Topics</h3>
						<ul class="related-list">
							{relatedTopics.map((topic) => (
								<li>{topic}</li>
							))}
						</ul>
					</section>
				)}
			</article>
		</main>

		<!-- Sidebar -->
		<aside class="wiki-sidebar">
			<!-- Exam Relevance -->
			<div class="sidebar-box">
				<h3>Exam Relevance</h3>
				<ul class="exam-list">
					{examRelevance.map((exam) => (
						<li class="exam-item">{exam}</li>
					))}
				</ul>
			</div>

			<!-- Difficulty Info -->
			<div class="sidebar-box">
				<h3>Difficulty Level</h3>
				<p class="difficulty-info">
					This question is rated as <strong>{difficulty}</strong> difficulty.
				</p>
			</div>

			<!-- Share Section -->
			<div class="sidebar-box">
				<h3>Share</h3>
				<div class="share-buttons">
					<a href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(question)}&url=${encodeURIComponent(Astro.url.href)}`} 
					   target="_blank" 
					   rel="noopener noreferrer"
					   class="share-btn">
						Twitter
					</a>
					<a href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`} 
					   target="_blank" 
					   rel="noopener noreferrer"
					   class="share-btn">
						Facebook
					</a>
					<a href={`https://wa.me/?text=${encodeURIComponent(question + ' - ' + Astro.url.href)}`} 
					   target="_blank" 
					   rel="noopener noreferrer"
					   class="share-btn">
						WhatsApp
					</a>
				</div>
			</div>
		</aside>
	</div>
</WikiLayout>

<style>
	.wiki-breadcrumb {
		margin-bottom: 1.5rem;
		font-size: 0.9rem;
	}

	.wiki-breadcrumb ol {
		list-style: none;
		padding: 0;
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}

	.wiki-breadcrumb li:not(:last-child)::after {
		content: "›";
		margin-left: 0.5rem;
		color: #666;
	}

	.wiki-breadcrumb a {
		color: #0645ad;
		text-decoration: none;
	}

	.wiki-breadcrumb a:hover {
		text-decoration: underline;
	}

	.wiki-container {
		display: grid;
		grid-template-columns: 1fr 300px;
		gap: 2rem;
		max-width: 1400px;
		margin: 0 auto;
	}

	@media (max-width: 968px) {
		.wiki-container {
			grid-template-columns: 1fr;
		}

		.wiki-sidebar {
			order: -1;
		}
	}

	.wiki-main-content {
		min-width: 0;
	}

	.wiki-article {
		background: white;
		padding: 2rem;
		border: 1px solid #a2a9b1;
	}

	.article-header {
		border-bottom: 2px solid #a2a9b1;
		padding-bottom: 1.5rem;
		margin-bottom: 2rem;
	}

	.article-title {
		font-family: 'Georgia', serif;
		font-size: 2rem;
		color: #202122;
		margin-bottom: 1rem;
		line-height: 1.3;
	}

	.article-meta {
		display: flex;
		gap: 0.75rem;
		margin-bottom: 1rem;
		flex-wrap: wrap;
	}

	.difficulty-badge, .category-badge {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		border-radius: 3px;
		font-size: 0.85rem;
		font-weight: 600;
		text-transform: uppercase;
	}

	.difficulty-easy {
		background: #d4edda;
		color: #155724;
	}

	.difficulty-medium {
		background: #fff3cd;
		color: #856404;
	}

	.difficulty-hard {
		background: #f8d7da;
		color: #721c24;
	}

	.category-badge {
		background: #e9ecef;
		color: #495057;
	}

	.quick-answer-box {
		background: #f8f9fa;
		border-left: 4px solid #0645ad;
		padding: 1.5rem;
		margin-top: 1.5rem;
	}

	.quick-answer-label {
		font-size: 1.1rem;
		font-weight: 700;
		color: #0645ad;
		margin: 0 0 0.5rem 0;
	}

	.quick-answer-text {
		font-size: 1.1rem;
		color: #202122;
		margin: 0;
		font-weight: 600;
	}

	.article-content {
		line-height: 1.6;
		color: #202122;
	}

	.article-tags, .related-topics {
		margin-top: 2rem;
		padding-top: 1.5rem;
		border-top: 1px solid #a2a9b1;
	}

	.article-tags h3, .related-topics h3 {
		font-size: 1.1rem;
		margin-bottom: 0.75rem;
		color: #202122;
	}

	.tag-list, .related-list {
		list-style: none;
		padding: 0;
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.tag-link {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		background: #f8f9fa;
		border: 1px solid #a2a9b1;
		border-radius: 3px;
		color: #0645ad;
		text-decoration: none;
		font-size: 0.9rem;
	}

	.tag-link:hover {
		background: #e9ecef;
	}

	.related-list {
		flex-direction: column;
		gap: 0.25rem;
	}

	.related-list li {
		padding-left: 1rem;
		position: relative;
	}

	.related-list li::before {
		content: "→";
		position: absolute;
		left: 0;
		color: #0645ad;
	}

	.wiki-sidebar {
		position: sticky;
		top: 1rem;
		align-self: start;
	}

	.sidebar-box {
		background: #f8f9fa;
		border: 1px solid #a2a9b1;
		padding: 1.5rem;
		margin-bottom: 1.5rem;
	}

	.sidebar-box h3 {
		font-size: 1rem;
		margin: 0 0 1rem 0;
		color: #202122;
		border-bottom: 1px solid #a2a9b1;
		padding-bottom: 0.5rem;
	}

	.exam-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.exam-item {
		padding: 0.5rem 0;
		border-bottom: 1px solid #dee2e6;
		font-weight: 600;
		color: #495057;
	}

	.exam-item:last-child {
		border-bottom: none;
	}

	.difficulty-info {
		margin: 0;
		line-height: 1.6;
	}

	.share-buttons {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.share-btn {
		display: block;
		padding: 0.5rem 1rem;
		background: #0645ad;
		color: white;
		text-align: center;
		text-decoration: none;
		border-radius: 3px;
		font-size: 0.9rem;
	}

	.share-btn:hover {
		background: #043d80;
	}
</style>
